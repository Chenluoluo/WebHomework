<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>博客</title>
    <link rel="stylesheet" href="static/css/uikit.min.css">
    <link rel="stylesheet" href="static/css/uikit.gradient.min.css">
    <link rel="stylesheet" href="static/css/awesome.css">
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/uikit.min.js"></script>
</head>
<body class="uk-height-1-1">
    <nav class="uk-navbar uk-navbar-attached uk-margin-bottom">
        <div class="uk-container uk-container-center">
            <a href="Home.html" class="uk-navbar-brand">ChenLuoLuo</a>
            <ul class="uk-navbar-nav">
                <li><a href="Home.html"><i class="uk-icon-home"></i> 主页</a></li>
                <li><a href="Edit.html"><i class="uk-icon-book"></i> 编辑</a></li>
                <li><a href="#"><i class="uk-icon-code"></i> 源码</a></li>
            </ul>
            <div class="uk-navbar-flip">
                <ul class="uk-navbar-nav">
                    <li class="uk-parent" data-uk-dropdown>
                        <a href="#"><i class="uk-icon-user"></i>我的信息</a>
                        <div class="uk-dropdown uk-dropdown-navbar">
                            <ul class="uk-nav uk-nav-navbar">
                                <li><a href="SignIn.html"><i class="uk-icon-sign-out"></i> 登出</a></li>
                            </ul>
                        </div>
                    </li>
                    <li><a href="SignIn.html"><i class="uk-icon-sign-in"></i> 登陆</a></li>
                    <li><a href="Register.html"><i class="uk-icon-edit"></i> 注册</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="uk-container uk-container-center">
        <div class="uk-grid">
            <!-- content -->
                <div class="uk-width-medium-3-4">
                    <article class="uk-article">
                        <h2><a href="#">目标文件格式</a></h2>
                        <p class="uk-article-meta">发表于2017.11.28</p>
                        <!-- <p>文章内容</p> -->
                        <div class="post-body" itemprop="articleBody">
                            <h2 id="什么是目标文件"><a href="#什么是目标文件" class="headerlink" title="什么是目标文件"></a>什么是目标文件</h2>
                            <p>　　目标文件：编译器编译源代码后生成的文件。从结构上讲，它是已经编译后的可执行文件格式，只是还没有经过链接的过程，其中有些富豪或者有些地址还没有被调整。它本身就是按照可执行文件格式存储的，只是跟真正的可执行文件在结构上稍有不同。</p>
                            <p>　　可执行文件涵盖了程序的编译、链接、装载和执行的各个方面。</p>
                            <h2 id="目标文件格式"><a href="#目标文件格式" class="headerlink" title="目标文件格式"></a>目标文件格式</h2>
                            <p>　　Windows下的PE(Portable Excutable)和Linux下的ELF(Excutable Linkable Format)，他们都是COFF(Common File Format)格式的变种。目标文件就是源代码编译后，但未进行连接的那些中间文件，它跟可执行文件的内容、结构很相似，一般跟可执行文件一起采用一种格式存储。</p>
                            <p>　　不光是可执行文件(Windows的.exe和Linux下的ELF可执行文件)按照可执行文件格式存储。动态链接库(Dynamic Linking Library) (Windows的.dll和Linux的so) 和静态链接库(Static Linking Library) (Windows的.lib和Linux的.a)都按照可执行文件格式存储。他们在Windows下按照PE-COFF格式存储，Linux下按照ELF格式存储。</p>
                            <p>ELF文件标准里，把系统中太重ELF格式的文件归为以下四类：  </p>
                            <table border="1">
                                <thead>
                                    <tr>
                                    <th>ELF文件类型</th>
                                    <th>说明</th>
                                    <th>实例</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>可重定位文件(Relocatable File)</td>
                                        <td>这类文件包含了了代码和数据，可以被用来连接成可执行文件或共享目标文件，静态链接库也可以归为这一类</td>
                                        <td>Linux的.o Windows的.obj</td>
                                    </tr>
                                        <tr>
                                        <td>可执行文件(Executable File)</td>
                                        <td>这类文件包含了可直接执行的程序，它的代表就是ELF可执行文件，他们一般没有扩展名。</td>
                                        <td>例如/bin/bash文件 Windows的.exe</td>
                                    </tr>
                                    <tr>
                                        <td>共享目标文件(Shared Object File)</td>
                                        <td>这种文件包含了代码和数据，可以在以下两种情况下使用，一种是连接器可以使用这种文件跟其他的可重定位文件和共享目标文件连接，产生新的目标文件，第二种是动态链接器可以将几个这种共享目标文件与可执行文件结合，作为进程映像的一部分来运行</td>
                                        <td>Linux的.so Windows的DLL</td>
                                    </tr>
                                    <tr>
                                        <td>核心转储文件(Core Dump File)</td>
                                        <td>当进程意外终止时，系统可以将该进程的地址空间的内容及终止时的一些其他信息转储到核心转储文件</td>
                                        <td>Linux下的core dump</td>
                                    </tr>
                                </tbody>
                            </table>
                            <h2 id="目标文件是怎么样的"><a href="#目标文件是怎么样的" class="headerlink" title="目标文件是怎么样的"></a>目标文件是怎么样的</h2>
                            <p>　　目标文件中的内容至少有编译后的机器指令代码、数据。没错，除了这些内容外，目标文件还包括链接时所需要的一些信息，比如符号表、调试信息、字符串等。一般目标文件将这些信息按不同的属性，以“段（Segment）”的形式存储，在一般情况下，它们都表示一个一定长度的区域，基本上不加区别，唯一的区别是在ELF的链接视图和装载视图的时候。</p>
                            <p>　　程序源代码编译后的机器指令经常被放在代码段（Code Section）里，代码段常见的名字有“.code”或“.text”；全局变量和局部静态变量数据经常放在数据段（Data Section），数据段的一般名字都叫”.data”。让我们来看一个简单的程序被编译成目标文件后的结构，如下图所示。</p>
                            <p><a href="http://blog.chinaunix.net/attachment/201308/8/26548237_1375969136w4D4.png?_=3997971" class="fancybox" rel="group"><img src="http://blog.chinaunix.net/attachment/201308/8/26548237_1375969136w4D4.png?_=3997971" alt=""></a></p>
                            <p>　　假设上图的可执行文件（目标文件）的格式是ELF，从图中可以看出，ELF文件的开头是一个“文件头”，它描述了整个文件的文件属性，包括文件是否可执行、是静态链接还是动态链接、入口地址（假设是可执行文件）、目标硬件、目标操作系统等信息。文件头还包括一个段表(Section Table)，段表其实是一个描述文件中各个段的数组。段表描述了文件中各个段在文件中的便宜位置以及段的属性等。从段表中可以饿到每个段的所有信息。文件头后面就是各个段的内容，比如代码段保存的就是程序的指令等等。</p>
                            <p>　　对照上图来看，一般C语言的编译后执行语句都编译成机器代码，保存在.text段；已初始化的全局变量和局部静态变量都保存在.data段；未初始化的全局变量和局部静态变量放在一个叫.bss的段中，我们知道未初始化的全局变量和静态变量的默认值都为0，他们本应放在.data段中，但因其值为0，为她们在.data段中分配空间并且存放数据0是没有必要的。程序运行的时候它们的确是要占用内存空间的，并且可执行文件必须记录所有为初始化的全局变量和局部静态变量的大小综合，即为.bss段。<strong>所以.bss段只是为为初始化的全局变量和局部静态变量预留位置<br>而已，它并没有内容，所以他在文件中也不占据空间。</strong></p>
                            <p>　　<strong>总体来说，程序源代码经过编译之后主要分为两种段：程序指令和程序数据。代码段属于程序指令，而数据段和.bss段属于程序数据。</strong></p>
                            <h2 id="把指令和数据分开来放的原因："><a href="#把指令和数据分开来放的原因：" class="headerlink" title="把指令和数据分开来放的原因："></a>把指令和数据分开来放的原因：</h2><p>　　（1）程序被装载后，数据和指令分别被映射到两个虚存区域。由于数据区域对于进程来说是可读写的，而指令区域对于进程来说是只读的，所以这两个虚存区域的权限可以被分别设置成可读写和只读。这样可以防止程序的指令被有意或无意的改写。<br>　　（2）对于现代的CPU来说，它们有着极为强大的缓存体系。程序必须尽量提高缓存的命中率，指令区和数据区的分离有利于提高程序的局部性。<br>　　（3）就是当系统中运行着多个许多个该程序的副本时，它们的指令都是一样的，所以内存中只需要保存一份该程序的指令部分。对于指令这种只读的区域来说是这样，对于其他的只读数据也是这么。当然，每个副本进程的数据区域是不一样的，它们是进程私有的。</p>
                        </div>
                        </article>
                        <hr class="uk-article-divider">
                        <div class="uk-width-medium-3-4">
                            <h3>发表评论</h3>
                            <article class="uk-comment">
                                <header class="uk-comment-header">
                                    <img class="uk-comment-avatar uk-border-circle" width="50" height="50" src="{{ __user__.image }}">
                                    <h4 class="uk-comment-title">「Stay hungry. Stay foolish.」</h4>
                                </header>
                                <div class="uk-comment-body">
                                    <form id="form-comment" class="uk-form">
                                        <div class="uk-alert uk-alert-danger uk-hidden"></div>
                                        <div class="uk-form-row">
                                            <textarea rows="6" placeholder="说点什么吧" style="width:100%;resize:none;"></textarea>
                                        </div>
                                        <div class="uk-form-row">
                                            <button type="submit" class="uk-button uk-button-primary"><i class="uk-icon-comment"></i> 发表评论</button>
                                        </div>
                                    </form>
                                </div>
                            </article>
                        <hr class="uk-article-divider">
                        <h3>最新评论</h3>
                        <ul class="uk-comment-list">
                            留言一！
                            <li>
                                <article class="uk-comment">
                                    <header class="uk-comment-header">
                                        <img class="uk-comment-avatar uk-border-circle" width="50" height="50" src="static/img/user.png">
                                        <h4 class="uk-comment-title">肖司仪</h4>
                                        <p class="uk-comment-meta">2017.11.29</p>
                                    </header>
                                </article>
                            </li>
                            留言二！
                            <li>
                                <article class="uk-comment">
                                    <header class="uk-comment-header">
                                        <img class="uk-comment-avatar uk-border-circle" width="50" height="50" src="static/img/user.png">
                                        <h4 class="uk-comment-title">朱贺田</h4>
                                        <p class="uk-comment-meta">2017.11.30</p>
                                    </header>
                                </article>
                            </li>
                            留言三！
                            <li>
                                <article class="uk-comment">
                                    <header class="uk-comment-header">
                                        <img class="uk-comment-avatar uk-border-circle" width="50" height="50" src="static/img/user.png">
                                        <h4 class="uk-comment-title">张恒志</h4>
                                        <p class="uk-comment-meta">2017.11.31</p>
                                    </header>
                                </article>
                            </li>
                        </ul>
                    </div>
                    </div>
                    <div class="uk-width-medium-1-4">
                        <div class="uk-panel uk-panel-header">
                            <h3 class="uk-panel-title">友情链接</h3>
                            <ul class="uk-list uk-list-line">
                                <li><i class="uk-icon-thumbs-o-up"></i> <a href="#">编程</a></li>
                                <li><i class="uk-icon-thumbs-o-up"></i> <a href="#">读书</a></li>
                                <li><i class="uk-icon-thumbs-o-up"></i> <a href="#">比赛</a></li>
                                <li><i class="uk-icon-thumbs-o-up"></i> <a href="#">新闻</a></li>
                            </ul>
                        </div>
                    </div>
            <!-- // content -->
        </div>
    </div>

    <div class="uk-margin-large-top" style="background-color:#eee; border-top:1px solid #ccc;">
        <div class="uk-container uk-container-center uk-text-center">
            <div class="uk-panel uk-margin-top uk-margin-bottom">
                <p>
                    <a target="_blank" href="http://weibo.com/u/5661149316" class="uk-icon-button uk-icon-weibo"></a>
                    <a target="_blank" href="https://github.com/chenluoluo" class="uk-icon-button uk-icon-github"></a>
                    <a target="_blank" href="http://www.linkedin.com/in/chenluoluo" class="uk-icon-button uk-icon-linkedin-square"></a>
                    <a target="_blank" href="https://twitter.com/chenluoluo" class="uk-icon-button uk-icon-twitter"></a>
                </p>
                <p>Powered by <a href="http://www.ciwest.cn">ChenLuoLuo</a>. Copyright &copy; 2017. 
                    [<a href="#">Manage</a>]</p>
                <p><a href="http://www.ciwest.cn" target="_blank">www.ciwest.cn</a>. All rights reserved.</p>
            </div>

        </div>
    </div>
</body>
</html>

